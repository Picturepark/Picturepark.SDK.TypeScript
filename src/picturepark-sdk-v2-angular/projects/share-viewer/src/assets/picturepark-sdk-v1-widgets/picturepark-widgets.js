var pictureparkWidgets=function(){function e(e,t,i){return r=n[e]={dependencies:t,factory:i,exports:{},resolved:!1}}function t(e){if(!0!==e.resolved){e.resolved=!0;var r=e.dependencies.map(function(r){return"exports"===r?e.exports:function(){if(void 0!==n[r])return t(n[r]),n[r].exports;try{return require(r)}catch(e){throw Error("module '"+r+"' not found.")}}()});e.factory.apply(null,r)}}var r=null,n={require:{factory:void 0,dependencies:[],exports:function(e,t){return require(e,t)},resolved:!0}};return function(e){function t(){}function r(e,t){return function(){e.apply(t,arguments)}}function n(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void n._immediateFn(function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void s(t.promise,e)}o(t.promise,n)}else(1===e._state?o:s)(t.promise,e._value)}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof n)return e._state=3,e._value=t,void a(e);if("function"==typeof i)return void c(r(i,t),e)}e._state=1,e._value=t,a(e)}catch(t){s(e,t)}}function s(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)i(e,e._deferreds[t]);e._deferreds=null}function u(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function c(e,t){var r=!1;try{e(function(e){r||(r=!0,o(t,e))},function(e){r||(r=!0,s(t,e))})}catch(e){if(r)return;r=!0,s(t,e)}}var l=setTimeout;n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,r){var n=new this.constructor(t);return i(this,new u(e,r,n)),n},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,r){function n(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){n(o,e)},r)}t[o]=s,0==--i&&e(t)}catch(e){r(e)}}if(0===t.length)return e([]);for(var i=t.length,o=0;o<t.length;o++)n(o,t[o])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,r){r(e)})},n.race=function(e){return new n(function(t,r){for(var n=0,i=e.length;n<i;n++)e[n].then(t,r)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){l(e,0)},n._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},n._setImmediateFn=function(e){n._immediateFn=e},n._setUnhandledRejectionFn=function(e){n._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}(this),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PictureparkLiquid=t()}}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t){"use strict";function r(e){return s(e).replace(/&|<|>|"|'/g,function(e){return d[e]})}function n(e){return s(e).replace(/&(amp|lt|gt|#34|#39);/g,function(e){return f[e]})}function i(e){var t=(e+"").split(".");return t.length>1?t[1].length:0}function o(e,t){return Math.max(i(e),i(t))}function s(e){return(e=e||"")+""}function a(e){return function(t,r){var n=o(t,r);return e(t,r).toFixed(n)}}function u(e){return l.forOwn(h,function(t,r){return e.registerFilter(r,t)})}var c=e("./src/util/strftime.js"),l=e("./src/util/underscore.js"),p=e("./src/syntax.js").isTruthy,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},f={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&#39;":"'"},h={abs:function(e){return Math.abs(e)},append:function(e,t){return e+t},capitalize:function(e){return s(e).charAt(0).toUpperCase()+e.slice(1)},ceil:function(e){return Math.ceil(e)},date:function(e,t){return"now"===e&&(e=new Date),e instanceof Date?c(e,t):""},default:function(e,t){return p(e)?e:t},divided_by:function(e,t){return Math.floor(e/t)},downcase:function(e){return e.toLowerCase()},escape:r,escape_once:function(e){return r(n(e))},first:function(e){return e[0]},floor:function(e){return Math.floor(e)},join:function(e,t){return e.join(t)},last:function(e){return e[e.length-1]},lstrip:function(e){return s(e).replace(/^\s+/,"")},map:function(e,t){return e.map(function(e){return e[t]})},minus:a(function(e,t){return e-t}),modulo:a(function(e,t){return e%t}),newline_to_br:function(e){return e.replace(/\n/g,"<br />")},plus:a(function(e,t){return Number(e)+Number(t)}),prepend:function(e,t){return t+e},remove:function(e,t){return e.split(t).join("")},remove_first:function(e,t){return e.replace(t,"")},replace:function(e,t,r){return s(e).split(t).join(r)},replace_first:function(e,t,r){return s(e).replace(t,r)},reverse:function(e){return e.reverse()},round:function(e,t){var r=Math.pow(10,t||0);return Math.round(e*r,t)/r},rstrip:function(e){return s(e).replace(/\s+$/,"")},size:function(e){return e.length},slice:function(e,t,r){return e.substr(t,void 0===r?1:r)},sort:function(e,t){return e.sort(t)},split:function(e,t){return s(e).split(t)},strip:function(e){return s(e).trim()},strip_html:function(e){return s(e).replace(/<\/?\s*\w+\s*\/?>/g,"")},strip_newlines:function(e){return s(e).replace(/\n/g,"")},times:function(e,t){return e*t},truncate:function(e,t,r){return e=s(e),r=void 0===r?"...":r,t=t||16,e.length<=t?e:e.substr(0,t-r.length)+r},truncatewords:function(e,t,r){void 0===r&&(r="...");var n=e.split(" "),i=n.slice(0,t).join(" ");return n.length>t&&(i+=r),i},uniq:function(e){var t={};return(e||[]).filter(function(e){return!t.hasOwnProperty(e)&&(t[e]=!0,!0)})},upcase:function(e){return s(e).toUpperCase()},url_encode:encodeURIComponent};u.filters=h,t.exports=u},{"./src/syntax.js":13,"./src/util/strftime.js":20,"./src/util/underscore.js":21}],2:[function(e,t){"use strict";function r(e){(e=o.assign({root:["."],cache:!1,extname:".PictureparkLiquid",trim_right:!1,trim_left:!1,strict_filters:!1,strict_variables:!1},e)).root=n(e.root);var t=Object.create(k);return t.init(f(),h(e),e),t}function n(e){return o.isArray(e)?e:o.isString(e)?[e]:[]}var i=e("./src/scope"),o=e("./src/util/underscore.js"),s=e("./src/util/assert.js"),a=e("./src/tokenizer.js"),u=e("./src/util/fs.js").statFileAsync,c=e("./src/util/fs.js").readFileAsync,l=e("path"),p=e("./src/render.js"),d=e("./src/lexical.js"),f=e("./src/tag.js"),h=e("./src/filter.js"),g=e("./src/parser"),v=e("./src/syntax.js"),m=e("./tags"),w=e("./filters"),y=e("any-promise"),b=e("./src/util/promise.js").anySeries,x=e("./src/util/error.js"),k={init:function(e,t,r){return r.cache&&(this.cache={}),this.options=r,this.tag=e,this.filter=t,this.parser=g(e,t),this.renderer=p(),m(this),w(this),this},parse:function(e,t){var r=a.parse(e,t,this.options);return this.parser.parse(r)},render:function(e,t,r){r=o.assign({},this.options,r);var n=i.factory(t,r);return this.renderer.renderTemplates(e,n)},parseAndRender:function(e,t,r){var n=this;return y.resolve().then(function(){return n.parse(e)}).then(function(e){return n.render(e,t,r)}).catch(function(e){if(e instanceof x.RenderBreakError)return e.html;throw e})},renderFile:function(e,t,r){var n=this;return r=o.assign({},r),this.getTemplate(e,r.root).then(function(e){return n.render(e,t,r)})},evalOutput:function(e,t){var r=this.parser.parseOutput(e.trim());return this.renderer.evalOutput(r,t)},registerFilter:function(e,t){return this.filter.register(e,t)},registerTag:function(e,t){return this.tag.register(e,t)},lookup:function(e,t){t=this.options.root.concat(t||[]);var r=(t=o.uniq(t)).map(function(t){return l.resolve(t,e)});return b(r,function(e){return u(e).then(function(){return e})}).catch(function(r){throw"ENOENT"===r.code&&(r.message="Failed to lookup "+e+" in: "+t),r})},getTemplate:function(e,t){var r=this;return l.extname(e)||(e+=this.options.extname),this.lookup(e,t).then(function(e){if(r.options.cache){var t=r.cache[e];return t?y.resolve(t):c(e).then(function(e){return r.parse(e)}).then(function(t){return r.cache[e]=t})}return c(e).then(function(t){return r.parse(t,e)})})},express:function(e){e=e||{};var t=this;return function(r,n,i){s(o.isArray(this.root)||o.isString(this.root),"illegal views root, are you using express.js?"),e.root=this.root,t.renderFile(r,n,e).then(function(e){return i(null,e)}).catch(function(e){return i(e)})}}};r.lexical=d,r.isTruthy=v.isTruthy,r.isFalsy=v.isFalsy,r.evalExp=v.evalExp,r.evalValue=v.evalValue,r.Types={ParseError:x.ParseError,TokenizationEroor:x.TokenizationError,RenderBreakError:x.RenderBreakError,AssertionError:x.AssertionError},t.exports=r},{"./filters":1,"./src/filter.js":7,"./src/lexical.js":8,"./src/parser":10,"./src/render.js":11,"./src/scope":12,"./src/syntax.js":13,"./src/tag.js":14,"./src/tokenizer.js":15,"./src/util/assert.js":16,"./src/util/error.js":17,"./src/util/fs.js":18,"./src/util/promise.js":19,"./src/util/underscore.js":21,"./tags":32,"any-promise":3,path:6}],3:[function(e,t){"use strict";t.exports=e("./register")().Promise},{"./register":5}],4:[function(e,t){"use strict";var r="@@any-promise/REGISTRATION",n=null;t.exports=function(e,t){return function(i,o){i=i||null;var s=!1!==(o=o||{}).global;if(null===n&&s&&(n=e[r]||null),null!==n&&null!==i&&n.implementation!==i)throw new Error('any-promise already defined as "'+n.implementation+'".  You can only register an implementation before the first  call to require("any-promise") and an implementation cannot be changed');return null===n&&(n=null!==i&&void 0!==o.Promise?{Promise:o.Promise,implementation:i}:t(i),s&&(e[r]=n)),n}}},{}],5:[function(e,t){"use strict";t.exports=e("./loader")(window,function(){if(void 0===window.Promise)throw new Error("any-promise browser requires a polyfill or explicit registration e.g: require('any-promise/register/bluebird')");return{Promise:window.Promise,implementation:"window.Promise"}})},{"./loader":4}],6:[function(){"use strict"},{}],7:[function(e,t){"use strict";var r=e("./lexical.js"),n=e("./syntax.js"),i=e("./util/assert.js"),o=e("./util/underscore.js"),s=new RegExp(""+r.value.source,"g");t.exports=function(e){e=o.assign({},e);var t={},a={render:function(e,t){var r=this.args.map(function(e){return n.evalValue(e,t)});return r.unshift(e),this.filter.apply(null,r)},parse:function(n){var o=r.filterLine.exec(n);i(o,"illegal filter: "+n);var a=o[1],u=o[2]||"",c=t[a];if("function"!=typeof c){if(e.strict_filters)throw new TypeError("undefined filter: "+a);return this.name=a,this.filter=function(e){return e},this.args=[],this}for(var l=[];o=s.exec(u.trim());){var p=o[0],d=new RegExp(p+"\\s*:","g");l.push(d.test(o.input)?"'"+p+"'":p)}return this.name=a,this.filter=c,this.args=l,this}};return{construct:function(e){return Object.create(a).parse(e)},register:function(e,r){t[e]=r},clear:function(){t={}}}}},{"./lexical.js":8,"./syntax.js":13,"./util/assert.js":16,"./util/underscore.js":21}],8:[function(e,t){"use strict";var r=/'[^']*'/,n=/"[^"]*"/,i=new RegExp(r.source+"|"+n.source),o=new RegExp("(?:"+i.source+"|[^'\"])*"),s=/-?\d+/,a=/-?\d+\.?\d*|\.?\d+/,u=/true|false/,c=/[\w-]+/,l=new RegExp("\\[(?:"+i.source+"|[\\w-\\.]+)\\]"),p=new RegExp("(?:"+i.source+"|"+u.source+"|"+a.source+")"),d=new RegExp(c.source+"(?:\\."+c.source+"|"+l.source+")*"),f=new RegExp("(?:"+d.source+"|"+a.source+")"),h=new RegExp("\\("+f.source+"\\.\\."+f.source+"\\)"),g=new RegExp("\\(("+f.source+")\\.\\.("+f.source+")\\)"),v=new RegExp("(?:"+d.source+"|"+p.source+"|"+h.source+")"),m=new RegExp("(?:"+c.source+")\\s*:\\s*(?:"+v.source+")"),w=new RegExp("("+c.source+")\\s*:\\s*("+v.source+")","g"),y=new RegExp("^\\s*("+c.source+")\\s*([\\s\\S]*)\\s*$"),b=new RegExp("^"+p.source+"$","i"),x=new RegExp("^"+d.source+"$"),k=new RegExp("^"+a.source+"$"),j=new RegExp("^"+u.source+"$","i"),_=new RegExp("^"+i.source+"$"),E=new RegExp("^"+g.source+"$"),P=new RegExp("^"+s.source+"$"),T=new RegExp("(?:"+c.source+"\\s*:\\s*)?"+v.source),S=new RegExp(T.source+"(\\s*,\\s*"+T.source+")*"),L=new RegExp(c.source+"(?:\\s*:\\s*"+S.source+")?","g"),I=new RegExp("("+c.source+")(?:\\s*:\\s*("+S.source+"))?"),A=new RegExp("^"+I.source+"$"),C=[/\s+or\s+/,/\s+and\s+/,/==|!=|<=|>=|<|>|\s+contains\s+/];t.exports={quoted:i,number:a,bool:u,literal:p,filter:L,integer:s,hash:m,hashCapture:w,range:h,rangeCapture:g,identifier:c,value:v,quoteBalanced:o,operators:C,quotedLine:_,numberLine:k,boolLine:j,rangeLine:E,literalLine:b,filterLine:A,tagLine:y,isLiteral:function(e){return b.test(e)},isVariable:function(e){return x.test(e)},parseLiteral:function(e){var t=e.match(k);return t?Number(e):(t=e.match(j))?"true"===e.toLowerCase():(t=e.match(_))?e.slice(1,-1):void 0},isRange:function(e){return E.test(e)},matchValue:function(e){return v.exec(e)},isInteger:function(e){return P.test(e)}}},{}],9:[function(e,t){"use strict";var r={"==":function(e,t){return e===t},"!=":function(e,t){return e!==t},">":function(e,t){return null!==e&&null!==t&&e>t},"<":function(e,t){return null!==e&&null!==t&&t>e},">=":function(e,t){return null!==e&&null!==t&&e>=t},"<=":function(e,t){return null!==e&&null!==t&&t>=e},contains:function(e,t){return!!e&&("function"==typeof e.indexOf&&e.indexOf(t)>-1)},and:function(e,t){return e&&t},or:function(e,t){return e||t}};t.exports=r},{}],10:[function(e,t){"use strict";var r=e("./lexical.js"),n=e("./util/error.js").ParseError,i=e("./util/assert.js");t.exports=function(e,t){function o(e,t){try{var r=null;return r="tag"===e.type?s(e,t):"output"===e.type?a(e.value):e,r.token=e,r}catch(t){throw new n(t,e)}}function s(t,r){return"continue"===t.name||"break"===t.name?t:e.construct(t,r)}function a(e){var n=r.matchValue(e);i(n,"illegal output string: "+e);var o=n[0];e=e.substr(n.index+n[0].length);for(var s=[];n=r.filter.exec(e);)s.push([n[0].trim()]);return{type:"output",initial:o,filters:s.map(function(e){return t.construct(e)})}}var u={init:function(e){return this.tokens=e,this.handlers={},this},on:function(e,t){return this.handlers[e]=t,this},trigger:function(e,t){var r=this.handlers[e];return"function"==typeof r?(r(t),!0):void 0},start:function(){this.trigger("start");for(var e;!this.stopRequested&&(e=this.tokens.shift());)if(!(this.trigger("token",e)||"tag"===e.type&&this.trigger("tag:"+e.name,e))){var t=o(e,this.tokens);this.trigger("template",t)}return this.stopRequested||this.trigger("end"),this},stop:function(){return this.stopRequested=!0,this}};return{parse:function(e){for(var t,r=[];t=e.shift();)r.push(o(t,e));return r},parseTag:s,parseStream:function(e){return Object.create(u).init(e)},parseOutput:a}}},{"./lexical.js":8,"./util/assert.js":16,"./util/error.js":17}],11:[function(e,t){"use strict";function r(e){return"string"==typeof e?e:JSON.stringify(e)}var n=e("./syntax.js"),i=e("any-promise"),o=e("./util/promise.js").mapSeries,s=e("./util/error.js").RenderBreakError,a=e("./util/error.js").RenderError,u=e("./util/assert.js"),c={renderTemplates:function(e,t){function n(e){var n=this;return"tag"===e.type?this.renderTag(e,t).then(function(e){return void 0===e?"":e}):"output"===e.type?i.resolve().then(function(){return n.evalOutput(e,t)}).then(function(e){return void 0===e?"":r(e)}):i.resolve(e.value)}var c=this;u(t,"unable to evalTemplates: scope undefined");var l="";return o(e,function(e){return n.call(c,e).then(function(e){return l+=e}).catch(function(t){if(t instanceof s)throw t.resolvedHTML=l,t;throw new a(t,e)})}).then(function(){return l})},renderTag:function(e,t){return"continue"===e.name?i.reject(new s("continue")):"break"===e.name?i.reject(new s("break")):e.render(t)},evalOutput:function(e,t){return u(t,"unable to evalOutput: scope undefined"),e.filters.reduce(function(e,r){return r.render(e,t)},n.evalExp(e.initial,t))}};t.exports=function(){return Object.create(c)}},{"./syntax.js":13,"./util/assert.js":16,"./util/error.js":17,"./util/promise.js":19,"any-promise":3}],12:[function(e,t,r){"use strict";function n(e,t){for(var r=1,n=t;n<e.length;n++)if("["===e[n]&&r++,"]"===e[n]&&0==--r)return n;return-1}var i=e("./util/underscore.js"),o=e("./lexical.js"),s=e("./util/assert.js"),a=Object.prototype.toString,u={getAll:function(){for(var e={},t=this.scopes.length-1;t>=0;t--)i.assign(e,this.scopes[t]);return e},get:function(e){for(var t=this.scopes.length-1;t>=0;t--)try{return this.getPropertyByPath(this.scopes[t],e)}catch(t){if(/undefined variable/.test(t.message))continue;if(/Cannot read property/.test(t.message)){if(this.opts.strict_variables)throw t.message+=": "+e,t;continue}throw t.message+=": "+e,t}if(this.opts.strict_variables)throw new TypeError("undefined variable: "+e)},set:function(e,t){return this.setPropertyByPath(this.scopes[this.scopes.length-1],e,t),this},push:function(e){return s(e,"trying to push "+e+" into scopes"),this.scopes.push(e)},pop:function(){return this.scopes.pop()},unshift:function(e){return s(e,"trying to push "+e+" into scopes"),this.scopes.unshift(e)},shift:function(){return this.scopes.shift()},setPropertyByPath:function(e,t,r){if(i.isString(t))for(var n=t.replace(/\[/g,".").replace(/\]/g,"").split("."),o=0;o<n.length;o++){var s=n[o];if(o===n.length-1)return e[s]=r;void 0===e[s]&&(e[s]={}),e=e[s]||{}}},getPropertyByPath:function(e,t){var r=this.propertyAccessSeq(t+""),n=r.shift();if(!e.hasOwnProperty(n))throw new TypeError("undefined variable");var i=e[n],o=r.pop();if(r.forEach(function(e){return i=i[e]}),void 0!==o){if("size"===o&&("[object Array]"===a.call(i)||"[object String]"===a.call(i)))return i.length;i=i[o]}return i},propertyAccessSeq:function(e){for(var t=[],r="",i=0;i<e.length;i++)if("["===e[i]){t.push(r),r="";var a=e[i+1];if("'"!==a&&'"'!==a){var u=n(e,i+1);s(-1!==u,"unbalanced []: "+e),r=e.slice(i+1,u),t.push(o.isInteger(r)?r:this.get(r)),r="",i=u}else u=e.indexOf(a,i+2),s(-1!==u,"unbalanced "+a+": "+e),r=e.slice(i+2,u),t.push(r),r="",i=u+2}else"."===e[i]?(t.push(r),r=""):r+=e[i];return r.length&&t.push(r),t}};r.factory=function(e,t){t=i.assign({strict_variables:!1,strict_filters:!1,blocks:{},root:[]},t),e=i.assign(e,{PictureparkLiquid:t});var r=Object.create(u);return r.opts=t,r.scopes=[e],r}},{"./lexical.js":8,"./util/assert.js":16,"./util/underscore.js":21}],13:[function(e,t){"use strict";function r(e,t){a(t,"unable to evalExp: scope undefined");for(var i,u=s.operators,c=0;c<u.length;c++){var l=u[c],p=new RegExp("^("+s.quoteBalanced.source+")("+l.source+")("+s.quoteBalanced.source+")$");if(i=e.match(p)){var d=r(i[1],t);return(0,o[i[2].trim()])(d,r(i[3],t))}}if(i=e.match(s.rangeLine)){for(var f=n(i[1],t),h=n(i[2],t),g=[],v=f;h>=v;v++)g.push(v);return g}return n(e,t)}function n(e,t){return(e=e&&e.trim())?s.isLiteral(e)?s.parseLiteral(e):s.isVariable(e)?t.get(e):void 0:void 0}function i(e){return!1===e||void 0===e||null===e}var o=e("./operators.js"),s=e("./lexical.js"),a=e("../src/util/assert.js");t.exports={evalExp:r,evalValue:n,isTruthy:function(e){return!i(e)},isFalsy:i}},{"../src/util/assert.js":16,"./lexical.js":8,"./operators.js":9}],14:[function(e,t){"use strict";function r(e,t){var r,i={};for(n.hashCapture.lastIndex=0;r=n.hashCapture.exec(e);){var o=r[1],a=r[2];i[o]=s.evalValue(a,t)}return i}var n=e("./lexical.js"),i=e("./util/underscore.js"),o=e("any-promise"),s=e("./syntax.js"),a=e("./util/assert.js");t.exports=function(){var e={},t={render:function(e){var t=r(this.token.args,e),n=this.tagImpl;return"function"!=typeof n.render?o.resolve(""):o.resolve().then(function(){return"function"==typeof n.render?n.render(e,t):""}).catch(function(e){if(i.isError(e))throw e;var t="Please reject with an Error in "+n.render+", got "+e;throw new Error(t)})},parse:function(t,r){this.type="tag",this.token=t,this.name=t.name;var n=e[this.name];a(n,"tag "+this.name+" not found"),this.tagImpl=Object.create(n),this.tagImpl.parse&&this.tagImpl.parse(t,r)}};return{construct:function(e,r){var n=Object.create(t);return n.parse(e,r),n},register:function(t,r){e[t]=r},clear:function(){e={}}}}},{"./lexical.js":8,"./syntax.js":13,"./util/assert.js":16,"./util/underscore.js":21,"any-promise":3}],15:[function(e,t,r){"use strict";function n(e,t){(t=t||{}).trim_left&&(e=e.replace(/{%-?/g,"{%-")),t.trim_right&&(e=e.replace(/-?%}/g,"-%}"));var r=t.greedy?/\s+({%-)/g:/[\t\r ]*({%-)/g,n=t.greedy?/(-%})\s+/g:/(-%})[\t\r ]*\n?/g;return e.replace(r,"$1").replace(n,"$1")}var i=e("./lexical.js"),o=e("./util/error.js").TokenizationError,s=e("./util/underscore.js"),a=e("../src/util/assert.js");r.parse=function(e,t,r){function u(r,n,i){return{type:r,raw:i[n],value:i[n+1].trim(),line:c(i),input:e,file:t}}function c(e){var t=e.input.slice(v+1,e.index).split("\n");return m+=t.length-1,v=e.index,m+1}a(s.isString(e),"illegal input type"),e=n(e,r);for(var l,p,d,f=[],h=/({%-?([\s\S]*?)-?%})|({{([\s\S]*?)}})/g,g=0,v=-1,m=0;null!==(l=h.exec(e));){if(l.index>g&&(p=e.slice(g,l.index),f.push({type:"html",raw:p,value:p})),l[1]){var w=(d=u("tag",1,l)).value.match(i.tagLine);if(!w)throw new o("illegal tag syntax",d);d.name=w[1],d.args=w[2],f.push(d)}else d=u("output",3,l),f.push(d);g=h.lastIndex}return e.length>g&&(p=e.slice(g,e.length),f.push({type:"html",raw:p,value:p})),f},r.whiteSpaceCtrl=n},{"../src/util/assert.js":16,"./lexical.js":8,"./util/error.js":17,"./util/underscore.js":21}],16:[function(e,t){"use strict";var r=e("./error.js").AssertionError;t.exports=function(e,t){if(!e){if(t instanceof Error)throw t;throw t=t||"expect "+e+" to be true",new r(t)}}},{"./error.js":17}],17:[function(e,t){"use strict";function r(e,t){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.input=t.input,this.line=t.line,this.file=t.file;var r=a(t.input,t.line);this.message=c(e,t),this.stack=r+"\n"+(this.stack||"")}function n(e,t){l.assign(this,e),this.originalError=e,this.name=this.constructor.name,this.input=t.input,this.line=t.line,this.file=t.file;var r=a(t.input,t.line);this.message=c(e.message||"Unkown Error",t),this.stack=r+"\n"+(e.stack||"")}function i(e,t){if(e instanceof i)return e;l.assign(this,e),this.originalError=e,this.name=this.constructor.name,this.input=t.token.input,this.line=t.token.line,this.file=t.token.file;var r=a(t.token.input,t.token.line);this.message=c(e.message||"Unkown Error",t.token),this.stack=r+"\n"+(e.stack||"")}function o(e){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e||""}function s(e){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}function a(e,t){var r=e.split("\n"),n=Math.max(t-2,1),i=Math.min(t+3,r.length);return l.range(n,i+1).map(function(e){return[e===t?">> ":"   ",u(e,i),"| ",r[e-1]].join("")}).join("\n")}function u(e,t){var r=(t+"").length,n=e+"";return Array(r-n.length).join(" ")+n}function c(e,t){return e=e||"",t.file&&(e+=", file:"+t.file),t.line&&(e+=", line:"+t.line),e}var l=e("./underscore.js");(r.prototype=Object.create(Error.prototype)).constructor=r,(n.prototype=Object.create(Error.prototype)).constructor=n,i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,(o.prototype=Object.create(Error.prototype)).constructor=o,(s.prototype=Object.create(Error.prototype)).constructor=s,t.exports={TokenizationError:r,ParseError:n,RenderBreakError:o,AssertionError:s,RenderError:i}},{"./underscore.js":21}],18:[function(e,t){"use strict";var r=e("fs");t.exports={readFileAsync:function(e){return new Promise(function(t,n){r.readFile(e,"utf8",function(e,r){e?n(e):t(r)})})},statFileAsync:function(e){return new Promise(function(t,n){r.stat(e,function(e,r){return e?n(e):t(r)})})}}},{fs:6}],19:[function(e,t,r){"use strict";var n=e("any-promise");r.anySeries=function(e,t){var r=n.reject(new Error("init"));return e.forEach(function(n,i){r=r.catch(function(){return t(n,i,e)})}),r},r.mapSeries=function(e,t){var r=n.resolve("init"),i=[];return e.forEach(function(n,o){r=r.then(function(){return t(n,o,e)}).then(function(e){return i.push(e)})}),r.then(function(){return i})}},{"any-promise":3}],20:[function(e,t){"use strict";var r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s={1:"st",2:"nd",3:"rd",default:"th"},a={daysInMonth:function(e){return[31,a.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31]},getDayOfYear:function(e){for(var t=0,r=0;r<e.getMonth();++r)t+=a.daysInMonth(e)[r];return t+e.getDate()},getWeekOfYear:function(e,t){var r=this.getDayOfYear(e)+(t-e.getDay()),n=7-new Date(e.getFullYear(),0,1).getDay()+t;return u.pad(Math.floor((r-n)/7)+1,2)},isLeapYear:function(e){var t=e.getFullYear();return!(0!=(3&t)||!(t%100||t%400==0&&t))},getSuffix:function(e){var t=e.getDate().toString(),r=parseInt(t.slice(-1));return s[r]||s.default},century:function(e){return parseInt(e.getFullYear().toString().substring(0,2),10)}},u={pad:function(e,t,r){r||(r="0");for(var n=e.toString(),i=t-n.length;i-- >0;)n=r+n;return n}},c={a:function(e){return o[e.getDay()]},A:function(e){return i[e.getDay()]},b:function(e){return n[e.getMonth()]},B:function(e){return r[e.getMonth()]},c:function(e){return e.toLocaleString()},C:function(e){return a.century(e)},d:function(e){return u.pad(e.getDate(),2)},e:function(e){return u.pad(e.getDate(),2," ")},H:function(e){return u.pad(e.getHours(),2)},I:function(e){return u.pad(e.getHours()%12||12,2)},j:function(e){return u.pad(a.getDayOfYear(e),3)},k:function(e){return u.pad(e.getHours(),2," ")},l:function(e){return u.pad(e.getHours()%12||12,2," ")},L:function(e){return u.pad(e.getMilliseconds(),3)},m:function(e){return u.pad(e.getMonth()+1,2)},M:function(e){return u.pad(e.getMinutes(),2)},p:function(e){return e.getHours()<12?"AM":"PM"},P:function(e){return e.getHours()<12?"am":"pm"},q:function(e){return a.getSuffix(e)},s:function(e){return Math.round(e.valueOf()/1e3)},S:function(e){return u.pad(e.getSeconds(),2)},u:function(e){return e.getDay()||7},U:function(e){return a.getWeekOfYear(e,0)},w:function(e){return e.getDay()},W:function(e){return a.getWeekOfYear(e,1)},x:function(e){return e.toLocaleDateString()},X:function(e){return e.toLocaleTimeString()},y:function(e){return e.getFullYear().toString().substring(2,4)},Y:function(e){return e.getFullYear()},z:function(e){var t=e.getTimezoneOffset()/60*100;return(t>0?"-":"+")+u.pad(Math.abs(t),4)},"%":function(){return"%"}};c.h=c.b,c.N=c.L;t.exports=function(e,t){for(var r="",n=t;;){var i=/%./g,o=i.exec(n);if(!o)return r+n;r+=n.slice(0,i.lastIndex-2),n=n.slice(i.lastIndex);var s=o[0].charAt(1),a=c[s];r+=a?a.call(this,e):"%"+s}}},{}],21:[function(e,t,r){"use strict";function n(e,t){e=e||{};for(var r in e)if(e.hasOwnProperty(r)&&!1===t(e[r],r,e))break;return e}function i(e,t){return e?(n(t,function(t,r){e[r]=t}),e):e}function o(e){return null!==e&&"object"===(void 0===e?"undefined":s(e))}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};r.isString=function(e){return e instanceof String||"string"==typeof e},r.isArray=function(e){return e instanceof Array},r.isObject=o,r.isError=function(e){return"Error"===Object.prototype.toString.call(e).substr(-6,5)||"string"==typeof e.message&&"string"==typeof e.name},r.range=function(e,t,r){1===arguments.length&&(t=e,e=0),r=r||1;for(var n=[],i=e;t>i;i+=r)n.push(i);return n},r.forOwn=n,r.assign=function(e){return e=o(e)?e:{},Array.prototype.slice.call(arguments,1).forEach(function(t){i(e,t)}),e},r.uniq=function(e){for(var t={},r=[],n=0,i=e.length;i>n;++n)t.hasOwnProperty(e[n])||(r.push(e[n]),t[e[n]]=1);return r},r.echo=function(e){return function(t){return console.log("["+e+"]",t),t}}},{}],22:[function(e,t){"use strict";var r=e("..").lexical,n=e("any-promise"),i=new RegExp("("+r.identifier.source+")\\s*=(.*)"),o=e("../src/util/assert.js");t.exports=function(e){e.registerTag("assign",{parse:function(e){var t=e.args.match(i);o(t,"illegal token "+e.raw),this.key=t[1],this.value=t[2]},render:function(t){return t.set(this.key,e.evalOutput(this.value,t)),n.resolve("")}})}},{"..":2,"../src/util/assert.js":16,"any-promise":3}],23:[function(e,t){"use strict";var r=e("..").lexical,n=new RegExp("("+r.identifier.source+")"),i=e("../src/util/assert.js");t.exports=function(e){e.registerTag("capture",{parse:function(t,r){var o=this,s=t.args.match(n);i(s,t.args+" not valid identifier"),this.variable=s[1],this.templates=[];var a=e.parser.parseStream(r);a.on("tag:endcapture",function(){return a.stop()}).on("template",function(e){return o.templates.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")}),a.start()},render:function(t){var r=this;return e.renderer.renderTemplates(this.templates,t).then(function(e){t.set(r.variable,e)})}})}},{"..":2,"../src/util/assert.js":16}],24:[function(e,t){"use strict";var r=e("..");e("../src/util/assert.js"),t.exports=function(e){e.registerTag("case",{parse:function(t,r){var n=this;this.cond=t.args,this.cases=[],this.elseTemplates=[];var i=[],o=e.parser.parseStream(r).on("tag:when",function(e){n.cases[e.args]||n.cases.push({val:e.args,templates:i=[]})}).on("tag:else",function(){return i=n.elseTemplates}).on("tag:endcase",function(){return o.stop()}).on("template",function(e){return i.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")});o.start()},render:function(t){for(var n=0;n<this.cases.length;n++){var i=this.cases[n];if(r.evalExp(i.val,t)===r.evalExp(this.cond,t))return e.renderer.renderTemplates(i.templates,t)}return e.renderer.renderTemplates(this.elseTemplates,t)}})}},{"..":2,"../src/util/assert.js":16}],25:[function(e,t){"use strict";t.exports=function(e){e.registerTag("comment",{parse:function(t,r){var n=e.parser.parseStream(r);n.on("token",function(e){"endcomment"===e.name&&n.stop()}).on("end",function(){throw new Error("tag "+t.raw+" not closed")}),n.start()}})}},{}],26:[function(e,t){"use strict";var r=e(".."),n=e("any-promise"),i=r.lexical,o=new RegExp("^(?:("+i.value.source+")\\s*:\\s*)?(.*)$"),s=new RegExp(i.value.source,"g"),a=e("../src/util/assert.js");t.exports=function(e){e.registerTag("cycle",{parse:function(e){var t=o.exec(e.args);a(t,"illegal tag: "+e.raw),this.group=t[1]||"";var r=t[2];for(this.candidates=[];t=s.exec(r);)this.candidates.push(t[0]);a(this.candidates.length,"empty candidates: "+e.raw)},render:function(e){var t="cycle:"+r.evalValue(this.group,e)+":"+this.candidates.join(","),i=e.get("PictureparkLiquid"),o=i[t];void 0===o&&(o=i[t]=0);var s=this.candidates[o];return o=(o+1)%this.candidates.length,i[t]=o,n.resolve(r.evalValue(s,e))}})}},{"..":2,"../src/util/assert.js":16,"any-promise":3}],27:[function(e,t){"use strict";var r=e("..").lexical,n=e("../src/util/assert.js");t.exports=function(e){e.registerTag("decrement",{parse:function(e){var t=e.args.match(r.identifier);n(t,"illegal identifier "+e.args),this.variable=t[0]},render:function(e){var t=e.get(this.variable);"number"!=typeof t&&(t=0),e.set(this.variable,t-1)}})}},{"..":2,"../src/util/assert.js":16}],28:[function(e,t){"use strict";var r=e(".."),n=r.lexical,i=e("../src/util/promise.js").mapSeries,o=r.Types.RenderBreakError,s=e("../src/util/assert.js"),a=new RegExp("^("+n.identifier.source+")\\s+in\\s+("+n.value.source+")(?:\\s+"+n.hash.source+")*(?:\\s+(reversed))?(?:\\s+"+n.hash.source+")*$");t.exports=function(e){e.registerTag("for",{parse:function(t,r){var n=this,i=a.exec(t.args);s(i,"illegal tag: "+t.raw),this.variable=i[1],this.collection=i[2],this.reversed=!!i[3],this.templates=[],this.elseTemplates=[];var o,u=e.parser.parseStream(r).on("start",function(){return o=n.templates}).on("tag:else",function(){return o=n.elseTemplates}).on("tag:endfor",function(){return u.stop()}).on("template",function(e){return o.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")});u.start()},render:function(t,n){var s=this,a=r.evalExp(this.collection,t);if(!Array.isArray(a)||Array.isArray(a)&&0===a.length)return e.renderer.renderTemplates(this.elseTemplates,t);var u=a.length,c=n.offset||0,l=void 0===n.limit?a.length:n.limit;a=a.slice(c,c+l),this.reversed&&a.reverse();var p=a.map(function(e,t){var r={};return r[s.variable]=e,r.forloop={first:0===t,index:t+1,index0:t,last:t===u-1,length:u,rindex:u-t,rindex0:u-t-1,stop:!1,skip:!1},r}),d="";return i(p,function(r){return t.push(r),e.renderer.renderTemplates(s.templates,t).then(function(e){return d+=e}).catch(function(e){if(!(e instanceof o&&(d+=e.resolvedHTML,"continue"===e.message)))throw e}).then(function(){return t.pop()})}).catch(function(e){if(!(e instanceof o&&"break"===e.message))throw e}).then(function(){return d})}})}},{"..":2,"../src/util/assert.js":16,"../src/util/promise.js":19}],29:[function(e,t){"use strict";var r=e("..");t.exports=function(e){e.registerTag("if",{parse:function(t,r){var n=this;this.branches=[],this.elseTemplates=[];var i,o=e.parser.parseStream(r).on("start",function(){return n.branches.push({cond:t.args,templates:i=[]})}).on("tag:elsif",function(e){n.branches[e.args]||n.branches.push({cond:e.args,templates:i=[]})}).on("tag:else",function(){return i=n.elseTemplates}).on("tag:endif",function(){return o.stop()}).on("template",function(e){return i.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")});o.start()},render:function(t){for(var n=0;n<this.branches.length;n++){var i=this.branches[n],o=r.evalExp(i.cond,t);if(r.isTruthy(o))return e.renderer.renderTemplates(i.templates,t)}return e.renderer.renderTemplates(this.elseTemplates,t)}})}},{"..":2}],30:[function(e,t){"use strict";var r=e(".."),n=r.lexical,i=new RegExp("with\\s+("+n.value.source+")"),o=e("../src/util/assert.js");t.exports=function(e){e.registerTag("include",{parse:function(e){var t=n.value.exec(e.args);o(t,"illegal token "+e.raw),this.value=t[0],(t=i.exec(e.args))&&(this.with=t[1])},render:function(t,n){var i=r.evalValue(this.value,t),o=t.get("PictureparkLiquid"),s=o.blocks;return o.blocks={},this.with&&(n[i]=r.evalValue(this.with,t)),e.getTemplate(i,o.root).then(function(r){return t.push(n),e.renderer.renderTemplates(r,t)}).then(function(e){return t.pop(),o.blocks=s,e})}})}},{"..":2,"../src/util/assert.js":16}],31:[function(e,t){"use strict";var r=e(".."),n=e("../src/util/assert.js"),i=r.lexical;t.exports=function(e){e.registerTag("increment",{parse:function(e){var t=e.args.match(i.identifier);n(t,"illegal identifier "+e.args),this.variable=t[0]},render:function(e){var t=e.get(this.variable);"number"!=typeof t&&(t=0),e.set(this.variable,t+1)}})}},{"..":2,"../src/util/assert.js":16}],32:[function(e,t){"use strict";t.exports=function(t){e("./assign.js")(t),e("./capture.js")(t),e("./case.js")(t),e("./comment.js")(t),e("./cycle.js")(t),e("./decrement.js")(t),e("./for.js")(t),e("./if.js")(t),e("./include.js")(t),e("./increment.js")(t),e("./layout.js")(t),e("./raw.js")(t),e("./tablerow.js")(t),e("./unless.js")(t)}},{"./assign.js":22,"./capture.js":23,"./case.js":24,"./comment.js":25,"./cycle.js":26,"./decrement.js":27,"./for.js":28,"./if.js":29,"./include.js":30,"./increment.js":31,"./layout.js":33,"./raw.js":34,"./tablerow.js":35,"./unless.js":36}],33:[function(e,t){"use strict";var r=e(".."),n=e("any-promise"),i=r.lexical,o=e("../src/util/assert.js");t.exports=function(e){e.registerTag("layout",{parse:function(t,r){var n=i.value.exec(t.args);o(n,"illegal token "+t.raw),this.layout=n[0],this.tpls=e.parser.parse(r)},render:function(t,n){var i=r.evalValue(this.layout,t),o=t.get("PictureparkLiquid");return e.renderer.renderTemplates(this.tpls,t).then(function(){return e.getTemplate(i,o.root)}).then(function(e){return t.push(n),e}).then(function(r){return e.renderer.renderTemplates(r,t)}).then(function(e){return t.pop(),e})}}),e.registerTag("block",{parse:function(t,r){var n=this,i=/\w+/.exec(t.args);this.block=i?i[0]:"anonymous",this.tpls=[];var o=e.parser.parseStream(r).on("tag:endblock",function(){return o.stop()}).on("template",function(e){return n.tpls.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")});o.start()},render:function(t){var r=this,i=t.get("PictureparkLiquid"),o=i.blocks[this.block];return void 0===o?e.renderer.renderTemplates(this.tpls,t).then(function(e){return i.blocks[r.block]=e,e}):(i.blocks[this.block]=o,n.resolve(o))}})}},{"..":2,"../src/util/assert.js":16,"any-promise":3}],34:[function(e,t){"use strict";var r=e("any-promise");t.exports=function(e){e.registerTag("raw",{parse:function(t,r){var n=this;this.tokens=[];var i=e.parser.parseStream(r);i.on("token",function(e){"endraw"===e.name?i.stop():n.tokens.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")}),i.start()},render:function(){var e=this.tokens.map(function(e){return e.raw}).join("");return r.resolve(e)}})}},{"any-promise":3}],35:[function(e,t){"use strict";var r=e(".."),n=e("any-promise"),i=r.lexical,o=e("../src/util/assert.js"),s=new RegExp("^("+i.identifier.source+")\\s+in\\s+("+i.value.source+")(?:\\s+"+i.hash.source+")*$");t.exports=function(e){e.registerTag("tablerow",{parse:function(t,r){var n=this,i=s.exec(t.args);o(i,"illegal tag: "+t.raw),this.variable=i[1],this.collection=i[2],this.templates=[];var a,u=e.parser.parseStream(r).on("start",function(){return a=n.templates}).on("tag:endtablerow",function(){return u.stop()}).on("template",function(e){return a.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")});u.start()},render:function(t,i){var o,s,a=this,u=r.evalExp(this.collection,t)||[],c="<table>",l=i.offset||0,p=void 0===i.limit?u.length:i.limit,d=i.cols;if(!d)throw new Error("illegal cols: "+d);var f=[];return(u=u.slice(l,l+p)).some(function(e){var t={};t[a.variable]=e,f.push(t)}),f.reduce(function(r,n,i){return r.then(function(){return o=Math.floor(i/d)+1,1===(s=i%d+1)&&(1!==o&&(c+="</tr>"),c+='<tr class="row'+o+'">'),c+='<td class="col'+s+'">'}).then(function(){return t.push(n),e.renderer.renderTemplates(a.templates,t)}).then(function(e){return t.pop(n),c+=e,c+="</td>"})},n.resolve("")).then(function(){return o>0&&(c+="</tr>"),c+="</table>"}).catch(function(e){throw e})}})}},{"..":2,"../src/util/assert.js":16,"any-promise":3}],36:[function(e,t){"use strict";var r=e("..");t.exports=function(e){e.registerTag("unless",{parse:function(t,r){var n=this;this.templates=[],this.elseTemplates=[];var i,o=e.parser.parseStream(r).on("start",function(){i=n.templates,n.cond=t.args}).on("tag:else",function(){return i=n.elseTemplates}).on("tag:endunless",function(){return o.stop()}).on("template",function(e){return i.push(e)}).on("end",function(){throw new Error("tag "+t.raw+" not closed")});o.start()},render:function(t){var n=r.evalExp(this.cond,t);return r.isFalsy(n)?e.renderer.renderTemplates(this.templates,t):e.renderer.renderTemplates(this.elseTemplates,t)}})}},{"..":2}]},{},[2])(2)}),function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function s(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=s(t);return t.readAsArrayBuffer(e),r}function u(e){var t=new FileReader,r=s(t);return t.readAsText(e),r}function c(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function l(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m.arrayBuffer&&m.blob&&y(e))this._bodyArrayBuffer=l(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!b(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return x.indexOf(t)>-1?t:e}function f(e,t){var r=(t=t||{}).body;if(e instanceof f){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new i(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function h(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function g(e){var t=new i;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t}function v(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(m.arrayBuffer)var w=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=function(e){return e&&DataView.prototype.isPrototypeOf(e)},b=ArrayBuffer.isView||function(e){return e&&w.indexOf(Object.prototype.toString.call(e))>-1};i.prototype.append=function(e,n){e=t(e),n=r(n);var i=this.map[e];this.map[e]=i?i+","+n:n},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,n){this.map[t(e)]=r(n)},i.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},m.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},p.call(f.prototype),p.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var k=[301,302,303,307,308];v.redirect=function(e,t){if(-1===k.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=f,e.Response=v,e.fetch=function(e,t){return new Promise(function(r,n){var i=new f(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:g(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;r(new v(t,e))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.open(i.method,i.url,!0),"include"===i.credentials&&(o.withCredentials=!0),"responseType"in o&&m.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),e("templates",["require","exports"],function(e,t){"use strict";t.__esModule=!0;var r=function(){function e(){}return e.getTemplate=function(e){return"card"===e?this.getCard():"gallery"===e?this.getGallery():"list"===e?this.getList():"Template '"+e+"' not found."},e.getGallery=function(){return'\n      {% if config.renderStyles %}\n      <style>\n       .picturepark-widget-content-preview {\n         background-color: white;\n         padding: 40px;\n        }\n        .picturepark-widget-gallery-{{id}} {\n          float: left;\n          width: 100%;\n          position: relative;\n          margin-right: -4px;\n          margin-bottom: -4px;\n        }\n        .picturepark-widget-gallery-item-{{id}} {\n          overflow: hidden;\n          background: #cecece;\n          margin-right: 4px;\n          margin-bottom: 4px;\n          position: relative;\n        }\n        .picturepark-widget-gallery-item-image-{{id}} {\n          position: absolute;\n          margin: auto;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n        }\n        .picturepark-widget-gallery-item-thumbnail-{{id}} {\n          \n        }\n      </style>\n      {% endif %}\n\n      <div class="picturepark-widget-gallery picturepark-widget-gallery-{{id}}">\n        {% assign width = config.width | plus: -2 %}\n        {% assign height = config.height | plus: -1 %}\n        {% for selection in share.items %}\n          <div class="picturepark-widget-gallery-item picturepark-widget-gallery-item-{{id}}" style="float: left; width: {{ config.width }}px; height: {{ config.height }}px">\n            {% if selection.isMovie and config.showPlayers != \'no\' and config.showPlayers != \'false\' %}\n            <div id="player_{{ forloop.index0 }}_{{ id }}">\n            </div>\n            {% else %}\n            <a href="javascript:void(0)" onclick="javascript:pictureparkWidgets.players.showDetail(\'{{ config.token }}\', \'{{ selection.id }}\', \'{{ id }}\')">\n              {% if selection.isBinary == false %}\n                <div class="picturepark-widget-gallery-item-thumbnail picturepark-widget-gallery-item-thumbnail-{{id}}">{{ selection.displayValues.thumbnail }}</div>\n              {% else %}\n                <img class="picturepark-widget-gallery-item-image picturepark-widget-gallery-item-image-{{id}}" src="{% resizeById selection.id \'Preview\' width height %}" />\n              {% endif %}\n            </a>\n            {% endif %}\n          </div>\n        {% endfor %}\n    </div>\n    <br style="clear: both;" />'},e.getCard=function(){return'\n      {% if config.renderStyles %}\n      <style>\n       .picturepark-widget-content-preview {\n         background-color: white;\n         padding: 40px;\n        }\n        .picturepark-widget-{{id}} {\n          all: initial;\n          font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n          font-size: 13px;\n          float: left;\n          margin-right: 4px;\n          margin-bottom: 4px;\n        }\n        .picturepark-widget-card-{{id}} {\n          border: 1px solid lightgray;\n          border-radius: 0 0 4px 4px;\n        }\n\n        /** Footer */\n        .picturepark-widget-card-footer-content-{{id}} {\n          padding: 10px;\n        }\n        .picturepark-widget-card-footer-title-{{id}} {\n          font-weight: bold;\n        }\n        .picturepark-widget-card-footer-description-{{id}} {\n        }\n        .picturepark-widget-card-footer-gravatar-{{id}} {\n          border-radius: 50%;\n          margin-top: 0px;\n        }\n        .picturepark-widget-card-footer-gravatar-{{id}} {\n          vertical-align: middle;\n        }\n        .picturepark-widget-card-footer-hr-{{id}} {\n          color: lightgray;\n          margin-top: 8px;\n          margin-bottom: 8px;\n        }\n\n        /** Gallery */\n        .picturepark-widget-card-gallery-{{id}} {\n          line-height: 0;\n          overflow: hidden;\n          max-height: {{ config.width }};\n        }\n        .picturepark-widget-card-gallery-image-{{id}} {\n          position: absolute;\n          margin: auto;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n        }\n\n        /** Overlay */\n        .picturepark-widget-card-overlay-{{id}} {\n          opacity: 0;\n          position: absolute;\n          width: 100%;\n          bottom: 0px;\n          background: gray;\n          padding: 4px;\n        }\n        .picturepark-widget-{{id}}:hover\n        .picturepark-widget-card-overlay-{{id}} {\n          opacity: 0.8;\n        }\n        .picturepark-widget-card-overlay-title-{{id}} {\n          font-weight: bold;\n          color: white;\n        }\n        .picturepark-widget-card-overlay-description-{{id}} {\n          color: white;\n        }\n\n        /** Navigation */\n        .picturepark-widget-card-navigation-previous-{{id}} {\n          position: absolute; \n          left: 0; \n          top: 0; \n          bottom: 0; \n          width: 30px; \n          margin-top: 50px; \n          margin-bottom: 50px\n        }\n        .picturepark-widget-card-navigation-next-{{id}} {\n          position: absolute; \n          right: 0; \n          top: 0; \n          bottom: 0; \n          width: 30px; \n          margin-top: 50px; \n          margin-bottom: 50px\n        }\n      </style>\n      {% endif %}\n\n      <div class="picturepark-widget-card picturepark-widget-card-{{id}}" style="width: {{ config.width }}px">\n        <div style="position: relative">\n          {% assign width = config.width | plus: -2 %}\n          {% assign height = config.height | plus: -1 %}\n          <div id="gallery_{{ id }}" style="height: {{ height }}px; width: {{ width }}px; position: relative">\n            {% for selection in share.items %}\n            <div class="picturepark-widget-card-gallery picturepark-widget-card-gallery-{{id}}"\n                {% if forloop.first == false %}style="display: none"{% endif %}>\n              {% if selection.isMovie %}\n              <div id="player_{{ forloop.index0 }}_{{ id }}">\n              </div>\n              {% else %}\n              <a href="javascript:void(0)" onclick="javascript:pictureparkWidgets.players.showDetail(\'{{ config.token }}\', \'{{ selection.id }}\', \'{{ id }}\')">\n               {% if selection.isBinary == false %}\n                <div class="picturepark-widget-gallery-item-thumbnail picturepark-widget-gallery-item-thumbnail-{{id}}">{{ selection.displayValues.thumbnail }}</div>\n              {% else %}\n                <img class="picturepark-widget-gallery-item-image picturepark-widget-gallery-item-image-{{id}}" src="{% resizeById selection.id \'Preview\' width height %}" />\n              {% endif %}\n              </a>\n              {% endif %}\n              \n              {% if config.showLogo %}\n              <div style="position: absolute; bottom: 4px; right: 8px;">\n                <svg style="width: 120px;" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 690.93 75.96">\n                  <defs>\n                    <style>.cls-1{fill:#5b7d89;}.cls-2{fill:#818181;}.cls-3,.cls-4,.cls-5{fill:#fff;}.cls-4,.cls-5{filter:url(#AI_Shadow_1);}.cls-4{font-size:67.44px;font-family:Roboto-Regular, Roboto;}.cls-5{font-size:46.07px;font-family:Roboto-Light, Roboto;letter-spacing:-0.01em;}.cls-6{letter-spacing:0em;}</style>\n                    <filter id="AI_Shadow_1" name="AI_Shadow_1"><feGaussianBlur result="blur" stdDeviation="2" in="SourceAlpha"/>\n                      <feOffset result="offsetBlurredAlpha" dx="4" dy="4" in="blur"/><feMerge><feMergeNode in="offsetBlurredAlpha"/>\n                      <feMergeNode in="SourceGraphic"/></feMerge>\n                    </filter>\n                  </defs>\n                  <title>powered-by-pp</title>\n                  <path class="cls-1" d="M344.17,152.27V117.83a4.58,4.58,0,0,0-4.28-4.83h-53.6a4.58,4.58,0,0,0-4.29,4.83v34.44Z" transform="translate(-19.07 -110.92)"/>\n                  <path class="cls-2" d="M282,161.87v11.31a4.58,4.58,0,0,0,4.28,4.82h53.6a4.57,4.57,0,0,0,4.28-4.82V161.87Z" transform="translate(-19.07 -110.92)"/>\n                  <polygon class="cls-3" points="325.09 50.95 262.93 50.95 262.93 41.35 325.09 41.35 325.09 50.95 325.09 50.95"/>\n                  <text class="cls-4" transform="translate(347.46 57.69)">Picturepark</text>\n                  <text class="cls-5" transform="translate(0 57.66)">P<tspan class="cls-6" x="28.07" y="0">owered by</tspan></text>\n                </svg>\n              </div>\n              {% endif %}\n            </div>\n            {% endfor %}\n          </div>\n\n          {% if config.showOverlay %}\n            <div class="picturepark-widget-card-overlay picturepark-widget-card-overlay-{{id}}">\n              <div class="picturepark-widget-card-overlay-title picturepark-widget-card-overlay-title-{{id}}">{{ share.name }}</div>\n              {% if share.description %}\n                <div class="picturepark-widget-card-overlay-description picturepark-widget-card-overlay-description-{{id}}">{{ share.description }}</div>\n              {% endif %}\n            </div>\n          {% endif %}\n\n          {% if config.showNavigation and share.items.length > 1 %}\n          <a href="javascript:void(0)" onclick="javascript:pictureparkWidgets.players.showPrevious(\'{{ config.token }}\', \'gallery_{{ id }}\')"\n            class="picturepark-widget-card-navigation-previous picturepark-widget-card-navigation-previous-{{id}}">\n            <svg style="position: absolute; top: 50%; transform: translate(0,-50%);" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42.8 42.8"><path d="M11 21.7l18 20c0.1 0.1 0.2 0.2 0.4 0.2 0.1 0 0.3 0 0.4-0.1l2.9-2.9c0.2-0.2 0.2-0.5 0-0.7L17.9 21.3 32.7 4.6c0.2-0.2 0.2-0.5 0-0.7L29.7 1c-0.1-0.1-0.2-0.1-0.4-0.1h0c-0.1 0-0.3 0.1-0.4 0.2L11 21c-0.1 0.1-0.1 0.2-0.1 0.3C10.8 21.4 10.8 21.6 11 21.7z" fill="#CCCCCC"/></svg>\n          </a>\n          <a href="javascript:void(0)" onclick="javascript:pictureparkWidgets.players.showNext(\'{{ config.token }}\', \'gallery_{{ id }}\')"\n            class="picturepark-widget-card-navigation-next picturepark-widget-card-navigation-next-{{id}}">\n            <svg style="position: absolute; top: 50%; transform: translate(0,-50%);" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42.8 42.8"><path d="M32.7 21l-18-20c-0.1-0.1-0.2-0.2-0.4-0.2 -0.1 0-0.3 0-0.4 0.1L11 3.9c-0.2 0.2-0.2 0.5 0 0.7l14.8 16.7L11 38.1c-0.2 0.2-0.2 0.5 0 0.7l2.9 2.9c0.1 0.1 0.2 0.1 0.4 0.1h0c0.1 0 0.3-0.1 0.4-0.2l18-20c0.1-0.1 0.1-0.2 0.1-0.3C32.8 21.3 32.8 21.1 32.7 21z" fill="#CCCCCC"/></svg>\n          </a>\n          {% endif %}\n        </div>\n\n        {% if config.showFooter %}\n        <div class="picturepark-widget-card-footer-content picturepark-widget-card-footer-content-{{id}}">\n          <div class="picturepark-widget-card-footer-title picturepark-widget-card-footer-title-{{id}}">{{ share.name }}</div>\n          {% if share.description %}\n            <div class="picturepark-widget-card-footer-description picturepark-widget-card-footer-description-{{id}}">{{ share.description }}</div>\n          {% endif %}\n          <hr class="picturepark-widget-card-footer-hr picturepark-widget-card-footer-hr-{{id}}">\n          <div class="picturepark-widget-card-footer-gravatar picturepark-widget-card-footer-gravatar-{{id}}">\n            <img src="//www.gravatar.com/avatar/{{ share.audit.createdByUser.emailAddress | md5 }}?m=dd&size=32" class="picturepark-widget-card-footer-gravatar picturepark-widget-card-footer-gravatar-{{id}}" />\n            Shared by: {{ share.audit.createdByUser.firstName }} {{ share.audit.createdByUser.lastName }}\n            </div>\n        </div>\n        {% endif %}\n      </div>'},e.getList=function(){return'\n      {% if config.renderStyles %}\n      <style>\n        .picturepark-widget-{{id}} {\n          all: initial;\n          font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n          font-size: 13px;\n          float: left;\n          margin-right: 4px;\n          margin-bottom: 4px;\n        }\n        .picturepark-widget-list-{{id}} {\n          padding: 0px 12px 0px 12px;\n          position: relative;\n          border: 1px solid lightgray;\n          border-radius: 4px;\n        }\n        .picturepark-widget-list-header-{{id}} {\n          font-weight: bold;\n          font-size: 16px;\n          border-bottom: 2px solid #DCDCDC; \n          margin: 12px 0 16px 0; \n          padding: 0 0 12px 0; \n        }\n        .picturepark-widget-list-header-download-{{id}} {\n          font-size: 10pt; \n          padding-top: 3px; \n        }\n        .picturepark-widget-list-body-{{id}} {\n          list-style-type: none;\n          margin: 0 0 8px 0; \n          padding: 0;\n        }\n        .picturepark-widget-list-body-{{id}} li {\n          margin-bottom: 8px;\n        }\n      </style>\n      {% endif %}\n\n      <div class="picturepark-widget-list picturepark-widget-list-{{id}}" style="width: {{ config.width }}px">\n        <h1 class="picturepark-widget-list-header picturepark-widget-list-header-{{id}}">\n          {% translate \'List.HeaderDownloads\' %}\n          <span style="float:right" class="picturepark-widget-list-header-download picturepark-widget-list-header-download-{{id}}">\n            <a href="{{ share.url }}">{% translate \'List.ButtonDownloadAll\' %}</a>\n          </span>\n        </h1>\n        <ul class="picturepark-widget-list-body picturepark-widget-list-body-{{id}}">\n        {% for selection in share.items %}\n          <li>\n            <span style="float:right">\n              <a href="{{selection.originalUrl}}">\n                <svg height="19px" version="1.1" viewBox="0 0 14 19" width="14px" xmlns="http://www.w3.org/2000/svg" \n                     xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <title/><desc/><defs/>\n                  <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">\n                    <g fill="#000000" id="Core" transform="translate(-383.000000, -213.000000)">\n                      <g id="file-download" transform="translate(383.000000, 213.500000)">\n                        <path d="M14,6 L10,6 L10,0 L4,0 L4,6 L0,6 L7,13 L14,6 L14,6 Z M0,15 L0,17 L14,17 L14,15 L0,15 L0,15 Z" id="Shape"/>\n                      </g>\n                    </g>\n                  </g>\n                </svg>\n              </a>\n            </span>\n            <span>\n              <strong>{{ selection.displayValues.list }}</strong><br />\n              TBD\n            </span>\n          </li>\n        {% endfor %}\n        </ul>\n      </div>'},e}();t.PictureparkTemplates=r}),e("players",["require","exports"],function(e,t){"use strict";t.__esModule=!0;var r=function(){function e(){}return e.showPrevious=function(t,r){var n=document.pictureparkShareCache[t],i=e.getGallery(r);n.player&&n.player.stop();var o=i.index-1;o<0&&(o=i.children.length-1),e.showGalleryItem(i,o)},e.showNext=function(t,r){var n=document.pictureparkShareCache[t],i=e.getGallery(r);n.player&&n.player.stop();var o=i.index+1;o===i.children.length&&(o=0),e.showGalleryItem(i,o)},e.showGalleryItem=function(e,t){e.index!==t&&(e.children[e.index].element.style.display="none",e.children[t].element.style.display="")},e.getGallery=function(e){var t=[],r=-1,n=document.getElementById(e);if(n){for(var i=0;i<n.children.length;i++){var o=n.children[i],s="none"!==o.style.display;t.push({index:i,visible:s,element:o}),s&&(r=i)}return{children:t,index:r}}return null},e.showDetail=function(t,r,n){if(!e.loading){e.loading=!0;var i=document.pictureparkShareCache[t];e.showDetailById(r,i.items,n)}},e.showDetailById=function(t,r,n){var i=r.filter(function(e){return e.id===t})[0];if(i.isPdf&&1===r.length)this.showPdfJsItem(i),e.loading=!1;else if(i.isImage||i.isMovie||i.isPdf||!i.isBinary){var o=document.body.style.overflow;document.body.style.overflow="hidden",this.showPhotoSwipeItem(i,r,n?"gallery_"+n:void 0).then(function(){e.loading=!1,document.body.style.overflow=o})}else{var s=document.createElement("a");s.href=i.originalUrl,document.body.appendChild(s),s.click(),document.body.removeChild(s),e.loading=!1}},e.renderVideoPlayer=function(e,t,r,n){return this.loadVideoPlayer().then(function(i){if(i(t).setup)return i(t).setup({autostart:!1,image:e.previewUrl,file:e.originalUrl,type:e.originalFileExtension.substr(1),width:r,height:n})})},e.loadVideoPlayer=function(){return window.jwplayer?Promise.resolve(window.jwplayer):this.loadScript("https://content.jwplatform.com/libraries/DbXZPMBQ.js","jwplayer")},e.showPdfJsItem=function(t){var r=document.createElement("iframe");r.style.position="fixed",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.src=e.scriptsPath+"/pdfjs/viewer.html?file="+t.originalUrl;var n=document.body.style.overflow,i=function(e){var t=e||window.event;("key"in t?"Escape"==t.key||"Esc"==t.key:27==t.keyCode)&&o()},o=function(){document.body.removeChild(r),document.body.style.overflow=n,document.removeEventListener("keydown",i,!0)},s=!1;r.onload=function(e){document.body.style.overflow="hidden",s?o():s=!0},document.addEventListener("keydown",i,!0),document.body.appendChild(r)},e.showPhotoSwipeItem=function(t,r,n){return this.loadPhotoSwipe().then(function(i){r||(r=[t]);var o=r.map(function(r){return r.isImage?{src:r.previewUrl,w:r.detail.width,h:r.detail.height}:r.isPdf?{html:'<iframe style="position: absolute; left: 0; top: 40px; width: 100%; height: calc(100% - 40px)" src="'+e.scriptsPath+"/pdfjs/viewer.html?file="+r.originalUrl+'&closeButton=false" id="pdfjs_'+r.id+'"></iframe>'}:r.isMovie?{html:'<div id="jwplayer_'+r.id+'"></div>'}:r.isBinary?{html:"<br /><br /><br /><br />Not supported."}:{html:'<br /><br /><br /><br /><div class="picturepark-widget-content-preview"> '+t.displayValues.detail+"</div>"}}),s=new i.photoSwipe(i.element,i.photoSwipeDefault,o,{index:r.indexOf(t)});s.options.history=!1,s.init(),s.listen("afterChange",function(){var t=n?e.getGallery(n):void 0;t&&e.showGalleryItem(t,s.getCurrentIndex())});var a=[],u=[];if(r.filter(function(e){return e.isMovie||e.isPdf}).length>0){var c=function(){r.filter(function(e){return e.isMovie}).length>0&&e.loadVideoPlayer().then(function(){for(var t=0,n=r.filter(function(e){return e.isMovie});t<n.length;t++){var i=n[t];e.renderVideoPlayer(i,"jwplayer_"+i.id,window.innerWidth,window.innerHeight).then(function(e){if(e){a.push(e);var t=function(){return e.resize(window.innerWidth,window.innerHeight)};u.push(t),window.addEventListener("resize",t,!1)}})}});for(var t=0,n=r.filter(function(e){return e.isPdf});t<n.length;t++)!function(e){var t="pdfjs_"+e.id,r=document.getElementById(t);r&&(r.onload=function(){"about:blank"==r.contentWindow.location.href&&s.close()})}(n[t])};s.listen("beforeChange",c),setTimeout(c)}return new Promise(function(e){s.listen("close",function(){for(var t=0,r=a;t<r.length;t++)r[t].remove();for(var n=0,i=u;n<i.length;n++){var o=i[n];window.removeEventListener("resize",o,!1)}e()})})})},e.loadPhotoSwipe=function(){return window.PhotoSwipe?Promise.resolve({element:e.getPhotoSwipeElement(),photoSwipe:window.PhotoSwipe,photoSwipeDefault:window.PhotoSwipeUI_Default}):Promise.all([this.loadCss("https://cdn.rawgit.com/dimsemenov/PhotoSwipe/master/dist/photoswipe.css"),this.loadCss("https://cdn.rawgit.com/dimsemenov/PhotoSwipe/master/dist/default-skin/default-skin.css"),this.loadScript("https://cdn.rawgit.com/dimsemenov/PhotoSwipe/master/dist/photoswipe.min.js","PhotoSwipe"),this.loadScript("https://cdn.rawgit.com/dimsemenov/PhotoSwipe/master/dist/photoswipe-ui-default.min.js","PhotoSwipeUI_Default")]).then(function(t){t[0],t[1];var r=t[2],n=t[3];return{element:e.getPhotoSwipeElement(),photoSwipe:r,photoSwipeDefault:n}})},e.getPhotoSwipeElement=function(){var e=document.querySelectorAll(".pswp")[0];if(e)return e;var t=document.createElement("div");return t.id="photoswipe",t.innerHTML='\n        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n            <div class="pswp__bg"></div>\n            <div class="pswp__scroll-wrap">\n                <div class="pswp__container">\n                    <div class="pswp__item"></div>\n                    <div class="pswp__item"></div>\n                    <div class="pswp__item"></div>\n                </div>\n                <div class="pswp__ui pswp__ui--hidden">\n                    <div class="pswp__top-bar">\n                        <div class="pswp__counter"></div>\n                        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n                        <button class="pswp__button pswp__button--share" title="Share"></button>\n                        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n                        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n                        <div class="pswp__preloader">\n                            <div class="pswp__preloader__icn">\n                            <div class="pswp__preloader__cut">\n                                <div class="pswp__preloader__donut"></div>\n                            </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                        <div class="pswp__share-tooltip"></div> \n                    </div>\n                    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>\n                    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>\n                    <div class="pswp__caption">\n                        <div class="pswp__caption__center"></div>\n                    </div>\n                </div>\n            </div>\n        </div>',document.body.appendChild(t),document.querySelectorAll(".pswp")[0]},e.loadScript=function(e,t){return window.require?(console.log("Picturepark Widgets > Load external script via require(): "+e),new Promise(function(t){window.require([e],function(e){t(e)})})):(console.log("Picturepark Widgets > Load external script via tag: "+e),new Promise(function(r){var n=document.createElement("script");n.src=e,n.async=!0,n.onload=function(){r(window[t])},document.head.appendChild(n)}))},e.loadCss=function(e){return new Promise(function(t){var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,r.onload=function(){return t()},document.getElementsByTagName("head")[0].appendChild(r)})},e.loading=!1,e.scriptsPath=void 0,e.imageExtensions=[".jpg",".jpeg",".png",".gif"],e.videoExtensions=[".mov",".mp4",".mp3"],e}();t.PictureparkPlayers=r}),e("translations",["require","exports"],function(e,t){"use strict";function r(e,i){var o=i?i.split("-")[0].toLowerCase():"",s=t.TRANSLATIONS;if("string"==typeof e){var a=e.split(".");if(a.length>0)for(var u=0,c=a;u<c.length;u++){var l=c[u];if(!s[l]){s=null;break}s=s[l]}else s=null}else s=e;return s&&s[o]?s[o]:o!==n?r(e,n+"-"):"[!"+e+"]"}t.__esModule=!0,t.TRANSLATIONS={List:{HeaderDownloads:{en:"Downloads",de:"Downloads"},ButtonDownloadAll:{en:"Download all",de:"Alle herunterladen"}}};var n="en";t.translate=r}),e("rendering",["require","exports","translations"],function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,n,i,o,s;return i=2147483648&e,o=2147483648&t,r=1073741824&e,n=1073741824&t,s=(1073741823&e)+(1073741823&t),r&n?2147483648^s^i^o:r|n?1073741824&s?3221225472^s^i^o:1073741824^s^i^o:s^i^o}function n(e,t,r){return e&t|~e&r}function i(e,t,r){return e&r|t&~r}function o(e,t,r){return e^t^r}function s(e,t,r){return t^(e|~r)}function a(e,i,o,s,a,u,c){return e=r(e,r(r(n(i,o,s),a),c)),r(t(e,u),i)}function u(e,n,o,s,a,u,c){return e=r(e,r(r(i(n,o,s),a),c)),r(t(e,u),n)}function c(e,n,i,s,a,u,c){return e=r(e,r(r(o(n,i,s),a),c)),r(t(e,u),n)}function l(e,n,i,o,a,u,c){return e=r(e,r(r(s(n,i,o),a),c)),r(t(e,u),n)}function p(e){var t,r="",n="";for(t=0;t<=3;t++)r+=(n="0"+(e>>>8*t&255).toString(16)).substr(n.length-2,2);return r}var d,f,h,g,v,m,w,y,b,x=Array();for(x=function(e){for(var t,r=e.length,n=r+8,i=16*((n-n%64)/64+1),o=Array(i-1),s=0,a=0;a<r;)s=a%4*8,o[t=(a-a%4)/4]=o[t]|e.charCodeAt(a)<<s,a++;return t=(a-a%4)/4,s=a%4*8,o[t]=o[t]|128<<s,o[i-2]=r<<3,o[i-1]=r>>>29,o}(e=function(e){e=e.replace(/rn/g,"n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(e)),m=1732584193,w=4023233417,y=2562383102,b=271733878,d=0;d<x.length;d+=16)f=m,h=w,g=y,v=b,w=l(w=l(w=l(w=l(w=c(w=c(w=c(w=c(w=u(w=u(w=u(w=u(w=a(w=a(w=a(w=a(w,y=a(y,b=a(b,m=a(m,w,y,b,x[d+0],7,3614090360),w,y,x[d+1],12,3905402710),m,w,x[d+2],17,606105819),b,m,x[d+3],22,3250441966),y=a(y,b=a(b,m=a(m,w,y,b,x[d+4],7,4118548399),w,y,x[d+5],12,1200080426),m,w,x[d+6],17,2821735955),b,m,x[d+7],22,4249261313),y=a(y,b=a(b,m=a(m,w,y,b,x[d+8],7,1770035416),w,y,x[d+9],12,2336552879),m,w,x[d+10],17,4294925233),b,m,x[d+11],22,2304563134),y=a(y,b=a(b,m=a(m,w,y,b,x[d+12],7,1804603682),w,y,x[d+13],12,4254626195),m,w,x[d+14],17,2792965006),b,m,x[d+15],22,1236535329),y=u(y,b=u(b,m=u(m,w,y,b,x[d+1],5,4129170786),w,y,x[d+6],9,3225465664),m,w,x[d+11],14,643717713),b,m,x[d+0],20,3921069994),y=u(y,b=u(b,m=u(m,w,y,b,x[d+5],5,3593408605),w,y,x[d+10],9,38016083),m,w,x[d+15],14,3634488961),b,m,x[d+4],20,3889429448),y=u(y,b=u(b,m=u(m,w,y,b,x[d+9],5,568446438),w,y,x[d+14],9,3275163606),m,w,x[d+3],14,4107603335),b,m,x[d+8],20,1163531501),y=u(y,b=u(b,m=u(m,w,y,b,x[d+13],5,2850285829),w,y,x[d+2],9,4243563512),m,w,x[d+7],14,1735328473),b,m,x[d+12],20,2368359562),y=c(y,b=c(b,m=c(m,w,y,b,x[d+5],4,4294588738),w,y,x[d+8],11,2272392833),m,w,x[d+11],16,1839030562),b,m,x[d+14],23,4259657740),y=c(y,b=c(b,m=c(m,w,y,b,x[d+1],4,2763975236),w,y,x[d+4],11,1272893353),m,w,x[d+7],16,4139469664),b,m,x[d+10],23,3200236656),y=c(y,b=c(b,m=c(m,w,y,b,x[d+13],4,681279174),w,y,x[d+0],11,3936430074),m,w,x[d+3],16,3572445317),b,m,x[d+6],23,76029189),y=c(y,b=c(b,m=c(m,w,y,b,x[d+9],4,3654602809),w,y,x[d+12],11,3873151461),m,w,x[d+15],16,530742520),b,m,x[d+2],23,3299628645),y=l(y,b=l(b,m=l(m,w,y,b,x[d+0],6,4096336452),w,y,x[d+7],10,1126891415),m,w,x[d+14],15,2878612391),b,m,x[d+5],21,4237533241),y=l(y,b=l(b,m=l(m,w,y,b,x[d+12],6,1700485571),w,y,x[d+3],10,2399980690),m,w,x[d+10],15,4293915773),b,m,x[d+1],21,2240044497),y=l(y,b=l(b,m=l(m,w,y,b,x[d+8],6,1873313359),w,y,x[d+15],10,4264355552),m,w,x[d+6],15,2734768916),b,m,x[d+13],21,1309151649),y=l(y,b=l(b,m=l(m,w,y,b,x[d+4],6,4149444226),w,y,x[d+11],10,3174756917),m,w,x[d+2],15,718787259),b,m,x[d+9],21,3951481745),m=r(m,f),w=r(w,h),y=r(y,g),b=r(b,v);return(p(m)+p(w)+p(y)+p(b)).toLowerCase()},i=function(){function e(){}return e.create=function(){var e=PictureparkLiquid();return e.registerTag("translate",{parse:function(e){this.token=e},render:function(e,t){var n=this.token.args.split(" "),i=PictureparkLiquid.evalExp(n[0],e),o=navigator.language||navigator.userLanguage;return r.translate(i,o)}}),e.registerTag("resizeById",{parse:function(e){this.token=e},render:function(e,t){var r=this.token.args.split(" "),n=e.scopes[0].share,i=PictureparkLiquid.evalExp(r[0],e),o=PictureparkLiquid.evalExp(r[1],e),s=PictureparkLiquid.evalExp(r[2],e),a=PictureparkLiquid.evalExp(r[3],e);try{var u=n.items.filter(function(e){return e.id===i})[0];return"Preview"===o&&u.previewUrl?u.previewUrl+"/"+s+"/"+a:u.originalUrl+"/"+s+"/"+a}catch(e){return console.log(e),""}}}),e.registerFilter("md5",function(e){return n(e)}),e},e}();t.PictureparkRenderEngine=i}),e("config",["require","exports"],function(e,t){"use strict";t.__esModule=!0;var r=function(){function e(){}return e.get=function(e){for(var t={renderStyles:!0},r=0;r<e.attributes.length;r++){var n=e.attributes[r];if("data-token"===n.name)t.token=n.value;else if("data-picturepark-server"===n.name)t.server=n.value;else if("data-render-styles"===n.name)t.renderStyles="false"!==n.value.toLowerCase()&&"no"!==n.value.toLowerCase();else if("data-width"===n.name)t.width=parseInt(n.value),void 0===t.height&&(t.height=3*t.width/4);else if("data-height"===n.name)t.height=parseInt(n.value),void 0===t.width&&(t.width=4*t.height/3);else if(0===n.name.indexOf("data-")){var i=void 0;switch(n.value){case"false":i=!1;break;case"true":i=!0;break;default:i=n.value}t[n.name.substr(5).replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})]=i}}return t},e}();t.PictureparkConfig=r}),e("index",["require","exports","templates","players","rendering","config","players"],function(e,t,r,n,i,o,s){"use strict";function a(e){if(!e.isPictureparkProcessing){e.isPictureparkProcessing=!0;var t="Loading...",s="Failed to load data.",a="",u=Math.random().toString(36).substr(2,10),c="picturepark_widget_"+u,l=o.PictureparkConfig.get(e);if(e.innerHTML){var p=document.createElement("div");p.innerHTML=e.innerHTML;var d=p.children;d.loading&&(t=d.loading.innerHTML),d.content&&(a=d.content.innerHTML),d.error&&(s=d.error.innerHTML),!d.loading&&d.content&&d.error&&(a=e.innerHTML)}return e.outerHTML='<div class="picturepark-widget picturepark-widget-loading" id='+c+">"+t+"</div>",window.fetch(l.server+"/Service/PublicAccess/GetShare?token="+l.token).then(function(e){return e.json()}).then(function(e){var t=e.template;switch(t.kind){case"BasicTemplate":t.template="gallery";break;case"CardTemplate":t.template="card";break;case"ListTemplate":t.template="list"}Object.keys(l).forEach(function(e){t[e]=l[e]}),""===a&&(a=r.PictureparkTemplates.getTemplate(t.template||"card"));var o=e.url.replace("/Go/"+t.token+"/D",""),s=0,p={id:e.id,url:e.url,name:e.name,audit:e.audit,description:e.description,items:e.contentSelections.map(function(r){for(var i,a=r.outputs.map(function(n){if(e.embedContentItems){var i=e.embedContentItems.filter(function(e){return e.contentId===n.contentId&&e.outputFormatId===n.outputFormatId})[0];return{contentId:r.id,outputFormatId:n.outputFormatId,fileExtension:n.detail.fileExtension,url:i?i.url:null,detail:n.detail}}return{contentId:r.id,outputFormatId:n.outputFormatId,fileExtension:n.detail.fileExtension,url:o+"/Go/"+t.token+"/V/"+r.id+"/"+n.outputFormatId,detail:n.detail}}),u=a.filter(function(e){return"Preview"===e.outputFormatId})[0],c=0,l=["Pdf","VideoLarge","VideoMedium","AudioSmall","Original","Preview"];c<l.length&&"break"!==function(e){if(i=a.filter(function(t){return t.outputFormatId===e})[0])return"break"}(l[c]);c++);return{id:r.id,index:s++,displayValues:r.displayValues,detail:i?i.detail:null,isMovie:i?-1!==n.PictureparkPlayers.videoExtensions.indexOf(i.fileExtension):null,isImage:i?-1!==n.PictureparkPlayers.imageExtensions.indexOf(i.fileExtension):null,isPdf:i?".pdf"===i.fileExtension:null,isBinary:"ImageMetadata"===r.contentSchemaId||"VideoMetadata"===r.contentSchemaId||"AudioMetadata"===r.contentSchemaId||"FileMetadata"===r.contentSchemaId||"DocumentMetadata"===r.contentSchemaId,previewUrl:u?u.url:null,previewContentId:u?u.contentId:null,previewOutputFormatId:u?u.outputFormatId:null,originalUrl:i?i.url:null,originalContentId:i?i.contentId:null,originalOutputFormatId:i?i.outputFormatId:null,originalFileExtension:i?i.fileExtension:null}})};return document.pictureparkShareCache||(document.pictureparkShareCache={}),document.pictureparkShareCache[t.token]=p,i.PictureparkRenderEngine.create().parseAndRender(a,{id:u,elementId:c,share:p,config:t}).then(function(e){document.getElementById(c).outerHTML='<div class="picturepark-widget picturepark-widget-'+u+' picturepark-widget-loaded">'+e+"</div>";for(var r=0,i=p.items;r<i.length;r++)!function(e){if(e.isMovie){var r="player_"+e.index+"_"+u;setTimeout(function(){document.getElementById(r)&&n.PictureparkPlayers.renderVideoPlayer(e,r,t.width,t.height).then(function(e){p.player=e})})}}(i[r]);return!0})}).catch(function(e){return console.error(e),document.getElementById(c).outerHTML='<div class="picturepark-widget picturepark-widget-error">'+s+"</div>",!1})}}t.__esModule=!0,t.players=s.PictureparkPlayers,t.processScriptTag=a,void 0===n.PictureparkPlayers.scriptsPath&&(n.PictureparkPlayers.scriptsPath=function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++){var r=e[t],n=r.src.indexOf("picturepark-widgets.js");if(-1!==n)return r.src.substring(0,n)}}()),setTimeout(function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;++t){var r=e[t];r.hasAttribute("data-picturepark-server")&&a(r)}})}),Object.keys(n).map(function(e){return n[e]}).forEach(t),null!==r?r.exports:void 0}();